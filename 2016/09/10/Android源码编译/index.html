<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="Android源码编译"/>




  <meta name="keywords" content="Android, 散落的蒲公英" />










  <link rel="alternate" href="/default" title="散落的蒲公英">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.1" />



<link rel="canonical" href="https://ruihuancao.github.io/2016/09/10/Android源码编译/"/>



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css" />



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.1" />



  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>








<script>
  window.config = {"title":"散落的蒲公英","subtitle":"万物之中，希望至美；至美之物，永不凋零","description":"我们就这样一起到老吧","author":"曹瑞环","language":"zh-CN","timezone":null,"url":"https://ruihuancao.github.io","root":"/","permalink":":year/:month/:day/:title/","permalink_defaults":null,"source_dir":"source","public_dir":"public","tag_dir":"tags","archive_dir":"archives","category_dir":"categories","code_dir":"downloads/code","i18n_dir":":lang","skip_render":null,"new_post_name":":title.md","default_layout":"post","titlecase":false,"external_link":true,"filename_case":0,"render_drafts":false,"post_asset_folder":false,"relative_link":false,"future":true,"highlight":{"enable":true,"auto_detect":true,"line_number":false,"tab_replace":null},"default_category":"uncategorized","category_map":null,"tag_map":null,"date_format":"YYYY-MM-DD","time_format":"HH:mm:ss","per_page":15,"pagination_dir":"page","theme":"even","deploy":{"type":"git","repo":"git@github.com:ruihuancao/ruihuancao.github.io.git","branch":"master"},"ignore":[],"avatar":"/images/avatar.png","favicon":"/favicon.ico","archive_generator":{"per_page":20,"yearly":true,"monthly":true,"daily":false},"category_generator":{"per_page":20},"tag_generator":{"per_page":20},"index_generator":{"per_page":20,"order_by":"-date"},"marked":{"gfm":true,"pedantic":false,"sanitize":false,"tables":true,"breaks":true,"smartLists":true,"smartypants":true,"modifyAnchors":"","autolink":true},"server":{"port":4000,"log":false,"compress":false,"header":true},"since":2015,"rss":"default","menu":{"Home":"/","Archives":"/archives/","Categories":"/categories/","Tags":"/tags"},"color":"default","mode":"default","toc":true,"fancybox":true,"pjax":true,"copyright":{"enable":false,"license":"<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc/4.0/\" target=\"_blank\">知识共享署名-非商业性使用 4.0 国际许可协议</a>"},"reward":{"enable":false,"qrCode":{"wechat":null,"alipay":null}},"social":{"email":"ruihuancao@email.com","github":"https://github.com/ruihuancao"},"leancloud":{"app_id":null,"app_key":null},"baidu_analytics":null,"baidu_verification":null,"google_analytics":null,"google_verification":null,"disqus_shortname":null,"changyan":{"appid":null,"appkey":null},"livere_datauid":null,"version":"2.10.1"};
</script>

    <title> Android源码编译 - 散落的蒲公英 </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">散落的蒲公英</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/categories/">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">散落的蒲公英</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Android源码编译
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-09-10
        </span>
        
          <span class="post-category">
            
              <a href="/categories/开发/">开发</a>
            
              <a href="/categories/开发/Android/">Android</a>
            
          </span>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#编译源码，制作rom刷机"><span class="toc-text">编译源码，制作rom刷机</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#建立环境"><span class="toc-text">建立环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-安装openjdk-配置环境"><span class="toc-text">1.安装openjdk 配置环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-安装必需的依赖包"><span class="toc-text">2.安装必需的依赖包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-配置Usb可访问"><span class="toc-text">3.配置Usb可访问</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下载源码"><span class="toc-text">下载源码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-下载repo并配置"><span class="toc-text">1.下载repo并配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-初始化"><span class="toc-text">2.初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#使用初始化包初始化"><span class="toc-text">使用初始化包初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#传统初始化方式"><span class="toc-text">传统初始化方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编译源码"><span class="toc-text">编译源码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-清理"><span class="toc-text">1.清理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-设置环境"><span class="toc-text">2.设置环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-选择目标"><span class="toc-text">3.选择目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-编译"><span class="toc-text">4.编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-运行模拟器"><span class="toc-text">5.运行模拟器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-刷入真机中"><span class="toc-text">6. 刷入真机中</span></a></li></ol></li></ol></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <p>重新编译源码，刷最新的7.0到nexus5x中。本来之前有刷过了，不小心又把源码删了，重新下载，重新编译，正好也记录下</p>
<a id="more"></a>
<h1 id="编译源码，制作rom刷机"><a href="#编译源码，制作rom刷机" class="headerlink" title="编译源码，制作rom刷机"></a>编译源码，制作rom刷机</h1><p><a href="https://source.android.com/source/initializing.html" target="_blank" rel="noopener">AOSP文档</a></p>
<p><a href="https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/" target="_blank" rel="noopener">清华镜像文档</a></p>
<p>编译机器：Ubuntu14.0.4</p>
<p>刷入机器：LG的nexus5x</p>
<h2 id="建立环境"><a href="#建立环境" class="headerlink" title="建立环境"></a>建立环境</h2><h3 id="1-安装openjdk-配置环境"><a href="#1-安装openjdk-配置环境" class="headerlink" title="1.安装openjdk 配置环境"></a>1.安装openjdk 配置环境</h3><figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta"># 下载openjdk</span></span><br><span class="line">wget http:<span class="comment">//archive.ubuntu.com/ubuntu/pool/universe/o/openjdk-8/openjdk-8-jre-headless_8u45-b14-1_amd64.deb</span></span><br><span class="line"><span class="meta">#  SHA256 0f5aba8db39088283b51e00054813063173a4d8809f70033976f83e214ab56c0</span></span><br><span class="line">wget http:<span class="comment">//archive.ubuntu.com/ubuntu/pool/universe/o/openjdk-8/openjdk-8-jre_8u45-b14-1_amd64.deb</span></span><br><span class="line"><span class="meta"># SHA256 9ef76c4562d39432b69baf6c18f199707c5c56a5b4566847df908b7d74e15849</span></span><br><span class="line">wget http:<span class="comment">//archive.ubuntu.com/ubuntu/pool/universe/o/openjdk-8/openjdk-8-jdk_8u45-b14-1_amd64.deb</span></span><br><span class="line"><span class="meta"># SHA256 6e47215cf6205aa829e6a0a64985075bd29d1f428a4006a80c9db371c2fc3c4c</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 校验文件完整性</span></span><br><span class="line">sha256sum &#123;downloaded.deb file&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta"># 安装openjdk</span></span><br><span class="line">sudo apt-<span class="keyword">get</span> update</span><br><span class="line">sudo dpkg -i openjdk<span class="number">-8</span>-jre-headless_8u45-b14<span class="number">-1</span>_amd64.deb</span><br><span class="line">sudo dpkg -i openjdk<span class="number">-8</span>-jre_8u45-b14<span class="number">-1</span>_amd64.deb</span><br><span class="line">sudo dpkg -i openjdk<span class="number">-8</span>-jdk_8u45-b14<span class="number">-1</span>_amd64.deb</span><br><span class="line"></span><br><span class="line"><span class="meta"># 安装中出错处理,安装依赖,再次安装即可</span></span><br><span class="line">sudo apt-<span class="keyword">get</span> -f install</span><br><span class="line"></span><br><span class="line"><span class="meta"># 更新环境配置</span></span><br><span class="line">sudo update-alternatives --config java</span><br><span class="line">sudo update-alternatives --config javac</span><br></pre></td></tr></table></figure>
<h3 id="2-安装必需的依赖包"><a href="#2-安装必需的依赖包" class="headerlink" title="2.安装必需的依赖包"></a>2.安装必需的依赖包</h3><figure class="highlight q"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install git-core gnupg flex bison gperf build-essential \</span><br><span class="line"> zip curl zlib1g-<span class="built_in">dev</span> gcc-multilib g++-multilib libc6-<span class="built_in">dev</span>-i386 \</span><br><span class="line"> lib32ncurses5-<span class="built_in">dev</span> x11proto-core-<span class="built_in">dev</span> libx11-<span class="built_in">dev</span> lib32z-<span class="built_in">dev</span> ccache \</span><br><span class="line"> libgl1-mesa-<span class="built_in">dev</span> libxml2-utils xsltproc unzip</span><br></pre></td></tr></table></figure>
<h3 id="3-配置Usb可访问"><a href="#3-配置Usb可访问" class="headerlink" title="3.配置Usb可访问"></a>3.配置Usb可访问</h3><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ wget -S -O - http:<span class="regexp">//</span>source.android.com<span class="regexp">/source/</span><span class="number">51</span>-android.rules | sed <span class="string">"s/&lt;username&gt;/$USER/"</span> | sudo tee &gt;<span class="regexp">/dev/</span>null <span class="regexp">/etc/u</span>dev<span class="regexp">/rules.d/</span><span class="number">51</span>-android.rules; sudo udevadm control --reload-rules</span><br></pre></td></tr></table></figure>
<h2 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h2><h3 id="1-下载repo并配置"><a href="#1-下载repo并配置" class="headerlink" title="1.下载repo并配置"></a>1.下载repo并配置</h3><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">mkdir ~<span class="string">/bin</span></span><br><span class="line">PATH=~<span class="string">/bin</span>:$PATH</span><br><span class="line">curl https:<span class="string">//storage.googleapis.com/git-repo-downloads/repo</span> &gt; ~<span class="string">/bin/repo</span></span><br><span class="line">chmod a+x ~<span class="string">/bin/repo</span></span><br></pre></td></tr></table></figure>
<h3 id="2-初始化"><a href="#2-初始化" class="headerlink" title="2.初始化"></a>2.初始化</h3><p>有两种方式可以初始化</p>
<h4 id="使用初始化包初始化"><a href="#使用初始化包初始化" class="headerlink" title="使用初始化包初始化"></a>使用初始化包初始化</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget https:<span class="regexp">//mi</span>rrors.tuna.tsinghua.edu.cn<span class="regexp">/aosp-monthly/</span>aosp-latest.tar <span class="comment"># 下载初始化包</span></span><br><span class="line">tar xf aosp-latest.tar</span><br><span class="line">cd AOSP   <span class="comment"># 解压得到的 AOSP 工程目录</span></span><br><span class="line"><span class="comment"># 这时 ls 的话什么也看不到，因为只有一个隐藏的 .repo 目录</span></span><br><span class="line">repo sync <span class="comment"># 正常同步一遍即可得到完整目录</span></span><br><span class="line"><span class="comment"># 或 repo sync -l 仅checkout代码</span></span><br></pre></td></tr></table></figure>
<h4 id="传统初始化方式"><a href="#传统初始化方式" class="headerlink" title="传统初始化方式"></a>传统初始化方式</h4><ul>
<li><p>新建工作目录</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> WORKING_DIRECTORY</span><br><span class="line"><span class="built_in">cd</span> WORKING_DIRECTORY</span><br></pre></td></tr></table></figure>
</li>
<li><p>git 配置</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">git<span class="built_in"> config </span>--global user.name <span class="string">"Your Name"</span></span><br><span class="line">git<span class="built_in"> config </span>--global user.email <span class="string">"you@example.com"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment">#清华镜像</span></span><br><span class="line">repo init -u https:<span class="regexp">//</span>aosp.tuna.tsinghua.edu.cn<span class="regexp">/platform/m</span>anifest</span><br><span class="line">repo init -u https:<span class="regexp">//</span>aosp.tuna.tsinghua.edu.cn<span class="regexp">/platform/m</span>anifest -b android-<span class="number">4.0</span>.<span class="number">1</span>_r1</span><br><span class="line"><span class="comment">#google 官方</span></span><br><span class="line">repo init -u https:<span class="regexp">//</span>android.googlesource.com<span class="regexp">/platform/m</span>anifest</span><br><span class="line">repo init -u https:<span class="regexp">//</span>android.googlesource.com<span class="regexp">/platform/m</span>anifest -b android-<span class="number">4.0</span>.<span class="number">1</span>_r1</span><br></pre></td></tr></table></figure>
</li>
<li><p>同步</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">repo <span class="keyword">sync</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="编译源码"><a href="#编译源码" class="headerlink" title="编译源码"></a>编译源码</h2><h3 id="1-清理"><a href="#1-清理" class="headerlink" title="1.清理"></a>1.清理</h3><figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">make clobber</span></span><br></pre></td></tr></table></figure>
<h3 id="2-设置环境"><a href="#2-设置环境" class="headerlink" title="2.设置环境"></a>2.设置环境</h3><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">source</span> build/envsetup.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>
<h3 id="3-选择目标"><a href="#3-选择目标" class="headerlink" title="3.选择目标"></a>3.选择目标</h3><p>// 这里需要根据自己的机器选择对应的版本，并查看对应的驱动文件下载到源码目录，直接运行，会生成vendor目录<br><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">lunch</span> aosp_arm-eng</span><br></pre></td></tr></table></figure></p>
<h3 id="4-编译"><a href="#4-编译" class="headerlink" title="4.编译"></a>4.编译</h3><figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="built_in">make</span> -j4</span><br></pre></td></tr></table></figure>
<h3 id="5-运行模拟器"><a href="#5-运行模拟器" class="headerlink" title="5.运行模拟器"></a>5.运行模拟器</h3><figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">emulator</span></span><br></pre></td></tr></table></figure>
<h3 id="6-刷入真机中"><a href="#6-刷入真机中" class="headerlink" title="6. 刷入真机中"></a>6. 刷入真机中</h3><figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">adb</span> reboot <span class="keyword">bootloader</span></span><br><span class="line"><span class="keyword">fastboot </span>flashall -w</span><br></pre></td></tr></table></figure>

      
    </div>

    
      
      



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Android/">Android</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2016/09/12/Android内存泄漏总结/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Android内存泄露总结</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2016/06/17/Android Handler机制/">
        <span class="next-text nav-default">Android Handler机制</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.1"></script>

  </body>
</html>
