<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="Android 反编译"/>




  <meta name="keywords" content="Android, 万物之中，希望至美；至美之物，永不凋零" />










  <link rel="alternate" href="/default" title="万物之中，希望至美；至美之物，永不凋零">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.1" />



<link rel="canonical" href="https://ruihuancao.github.io/2016/12/28/Android反编译/"/>



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css" />



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.1" />



  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>








<script>
  window.config = {"title":"万物之中，希望至美；至美之物，永不凋零","subtitle":"万物之中，希望至美；至美之物，永不凋零","description":"我们就这样一起到老吧","author":"曹瑞环","language":"zh-CN","timezone":null,"url":"https://ruihuancao.github.io","root":"/","permalink":":year/:month/:day/:title/","permalink_defaults":null,"source_dir":"source","public_dir":"public","tag_dir":"tags","archive_dir":"archives","category_dir":"categories","code_dir":"downloads/code","i18n_dir":":lang","skip_render":null,"new_post_name":":title.md","default_layout":"post","titlecase":false,"external_link":true,"filename_case":0,"render_drafts":false,"post_asset_folder":false,"relative_link":false,"future":true,"highlight":{"enable":true,"auto_detect":true,"line_number":false,"tab_replace":null},"default_category":"uncategorized","category_map":null,"tag_map":null,"date_format":"YYYY-MM-DD","time_format":"HH:mm:ss","per_page":15,"pagination_dir":"page","theme":"even","deploy":{"type":"git","repo":"git@github.com:ruihuancao/ruihuancao.github.io.git","branch":"master"},"ignore":[],"avatar":"/images/avatar.png","favicon":"/favicon.ico","category_generator":{"per_page":20},"archive_generator":{"per_page":20,"yearly":true,"monthly":true,"daily":false},"index_generator":{"per_page":20,"order_by":"-date"},"tag_generator":{"per_page":20},"marked":{"gfm":true,"pedantic":false,"sanitize":false,"tables":true,"breaks":true,"smartLists":true,"smartypants":true,"modifyAnchors":"","autolink":true},"server":{"port":4000,"log":false,"compress":false,"header":true},"since":2015,"rss":"default","menu":{"Home":"/","Archives":"/archives/","Categories":"/categories/","Tags":"/tags"},"color":"cobalt blue","mode":"default","toc":true,"fancybox":true,"pjax":true,"copyright":{"enable":false,"license":"<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc/4.0/\" target=\"_blank\">知识共享署名-非商业性使用 4.0 国际许可协议</a>"},"reward":{"enable":false,"qrCode":{"wechat":null,"alipay":null}},"social":{"email":"ruihuancao@email.com","github":"https://github.com/ruihuancao"},"leancloud":{"app_id":null,"app_key":null},"baidu_analytics":null,"baidu_verification":null,"google_analytics":null,"google_verification":null,"disqus_shortname":null,"changyan":{"appid":null,"appkey":null},"livere_datauid":null,"version":"2.10.1"};
</script>

    <title> Android 反编译 - 万物之中，希望至美；至美之物，永不凋零 </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">万物之中，希望至美；至美之物，永不凋零</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/categories/">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">万物之中，希望至美；至美之物，永不凋零</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Android 反编译
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-12-28
        </span>
        
          <span class="post-category">
            
              <a href="/categories/Android/">Android</a>
            
          </span>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Apktool"><span class="toc-text">Apktool</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#下载配置"><span class="toc-text">下载配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用"><span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enjarify"><span class="toc-text">Enjarify</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JD-GUI"><span class="toc-text">JD-GUI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#完整流程"><span class="toc-text">完整流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#签名"><span class="toc-text">签名</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ClassyShark"><span class="toc-text">ClassyShark</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#APK-Analyzer"><span class="toc-text">APK Analyzer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#apk-文件结构"><span class="toc-text">apk 文件结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#打包流程"><span class="toc-text">打包流程</span></a></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <p>修改完善之前写的反编译，更新了自己最近使用的工具</p>
<a id="more"></a>
<h2 id="Apktool"><a href="#Apktool" class="headerlink" title="Apktool"></a>Apktool</h2><p><a href="https://ibotpeaches.github.io/Apktool/" target="_blank" rel="noopener">apktool</a>用来反编译资源文件</p>
<h3 id="下载配置"><a href="#下载配置" class="headerlink" title="下载配置"></a>下载配置</h3><figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">mkdir apktool</span><br><span class="line">cd apktool</span><br><span class="line">wget <span class="keyword">https</span>://raw.githubusercontent.com/iBotPeaches/Apktool/master/scripts/linux/apktool</span><br><span class="line">wget <span class="keyword">https</span>://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2<span class="number">.2</span><span class="number">.1</span>.jar</span><br><span class="line">mv apktool_2<span class="number">.2</span><span class="number">.1</span>.jar apktool.jar</span><br><span class="line"><span class="comment"># 将apktool加入系统变量或者修改</span></span><br><span class="line">sudo cp apktool /usr/<span class="built_in">local</span>/bin</span><br><span class="line">sudo cp apktool.jar /usr/<span class="built_in">local</span>/bin</span><br><span class="line">sudo chmod <span class="keyword">a</span>+x apktool</span><br><span class="line">sudo chmod <span class="keyword">a</span>+x apktool.jar</span><br></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight haml"><table><tr><td class="code"><pre><span class="line"># 反编译除资源文件</span><br><span class="line">apktool d HtcContacts.apk</span><br><span class="line"></span><br><span class="line"># 重新生产apk</span><br><span class="line">apktool b bar -o new_bar.apk</span><br><span class="line"></span><br><span class="line">-<span class="ruby">f 如果目标文件夹已存在，强制删除现有文件夹</span></span><br><span class="line"><span class="ruby">-o 指定反编译的目标文件夹的名称（默认会将文件输出到以Apk文件名命名的文件夹中）</span></span><br><span class="line"><span class="ruby">-s 保留classes.dex文件（默认会将dex文件解码成smali文件）</span></span><br><span class="line"><span class="ruby">-r 保留resources.arsc文件（默认会将resources.arsc解码成具体的资源文件）</span></span><br></pre></td></tr></table></figure>
<h2 id="Enjarify"><a href="#Enjarify" class="headerlink" title="Enjarify"></a>Enjarify</h2><p><a href="https://github.com/google/enjarify" target="_blank" rel="noopener">Enjarify</a>反编译dex文件。dex2jar的替代者<br>enjarify 是python3的程序，注意切换python环境到python3<br><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">git clone git@github<span class="selector-class">.com</span>:google/enjarify.git</span><br><span class="line">cd enjarify</span><br><span class="line">ln -s <span class="string">"$PWD/enjarify.sh"</span> ~/bin/enjarify</span><br><span class="line">enjarify test.apk</span><br></pre></td></tr></table></figure></p>
<p>这里已经将apk中的dex文件转换成jar包,然后就是查看了</p>
<h2 id="JD-GUI"><a href="#JD-GUI" class="headerlink" title="JD-GUI"></a>JD-GUI</h2><p><a href="http://jd.benow.ca/" target="_blank" rel="noopener">jd-gui</a>查看jar内容的工具,可以下载jar包，双击运行，然后打开enjarify生产的jar包查看代码<br>或者下载对应系统的版本运行查看</p>
<h2 id="完整流程"><a href="#完整流程" class="headerlink" title="完整流程"></a>完整流程</h2><p>反编译打包流程</p>
<ul>
<li>apktool反编译修改资源文件</li>
<li>enjarify或者dex2jar反编译dex，查看java代码,在上面文件中修改对应smail</li>
<li>apktool 重新生成apk</li>
<li>签名<h3 id="签名"><a href="#签名" class="headerlink" title="签名"></a>签名</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 生成签名文件（jdk自带）</span></span><br><span class="line">keytool -genkey -keystore test.keystore  -<span class="built_in">alias</span> <span class="built_in">test</span> -keyalg RSA -validity 10000</span><br><span class="line"><span class="comment"># 签名</span></span><br><span class="line">jarsigner -verbose -keystore test.keystore -signedjar -signed.apk unsigned.apk <span class="string">'test.keystore'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ClassyShark"><a href="#ClassyShark" class="headerlink" title="ClassyShark"></a>ClassyShark</h2><p><a href="https://github.com/google/android-classyshark" target="_blank" rel="noopener">ClassyShark</a>自动反编译，一键查看</p>
<h2 id="APK-Analyzer"><a href="#APK-Analyzer" class="headerlink" title="APK Analyzer"></a>APK Analyzer</h2><p>Android Studio2.2 版本加入新功能,一键查看反编译文件</p>
<h2 id="apk-文件结构"><a href="#apk-文件结构" class="headerlink" title="apk 文件结构"></a>apk 文件结构</h2><p> META-INF 签名文件<br> res 资源文件<br> AndroidManifest.xml 主配置文件<br> classes.dex java 编译产生的字节码文件<br> resources.arsc 资源索引<br> 其他文件 assets lib 等</p>
<h2 id="打包流程"><a href="#打包流程" class="headerlink" title="打包流程"></a>打包流程</h2><p>APK是Android Package的缩写，实际上APK就是一个zip压缩包，使用zip解压软件直接就能对其进行解压，解压后会发现就是由各种资源文件、一或多个dex文件（odex过的apk除外）、AndroidManifest.xml、resources.arsc以及其他一些文件组成的。</p>
<p>apk 构建流程：<a href="https://developer.android.com/studio/build/index.html#detailed-build" target="_blank" rel="noopener">https://developer.android.com/studio/build/index.html#detailed-build</a></p>
<ul>
<li>1 build-tools\aapt aapt编译资源文件</li>
<li>2 build-tools\aidl aidl生成java 代码</li>
<li>3 java 源码编译(build/intermediates/classes 输出的class文件)</li>
<li>4 build-tools\lib\dx.jar 将生成的class文件转换为Dalvik字节码</li>
<li>5 生产apk</li>
<li>6 签名</li>
<li>7 buildtools\zipalign 对签名后的apk文件进行对齐处理，使apk中所有资源文件距离文件起始偏移为4字节的整数倍，从而在通过内存映射访问apk文件时会更快</li>
</ul>

      
    </div>

    
      
      



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Android/">Android</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2017/01/12/Android性能优化/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Android 性能优化</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2016/10/03/Flask学习记录/">
        <span class="next-text nav-default">Flask学习记录</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.1"></script>

  </body>
</html>
